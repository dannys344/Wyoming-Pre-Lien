function generatePDF(type) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'letter'
    });

    // Determine which preview element to use based on type
    const previewElementId = type === 'lien' ? 'previewLienDocument' : 'previewLetterDocument';
    const propertyAddress = document.getElementById('propertyAddress').value || 'unknown-address';
    const sanitizedAddress = propertyAddress.replace(/[^\w\s]/gi, '').replace(/\s+/g, '-');
    const filename = type === 'lien' ? 
        `Notice of Right to Lien - ${sanitizedAddress}.pdf` : 
        `Notice Letter - ${sanitizedAddress}.pdf`;
    
    const previewElement = document.getElementById(previewElementId);
    
    if (type === 'lien') {
        // For the lien document with multiple pages
        // Split content by page breaks
        const pageContents = previewElement.innerHTML.split('<div class="page-break"></div>');
        let promiseChain = Promise.resolve();
        let pageCanvases = [];
        
        // Create a canvas for each page
        pageContents.forEach((content, index) => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            tempDiv.style.width = '215.9mm'; // Letter width
            tempDiv.style.padding = '15mm';
            tempDiv.style.fontFamily = 'Times New Roman';
            tempDiv.style.fontSize = '12pt';
            tempDiv.style.lineHeight = '1.5';
            tempDiv.style.whiteSpace = 'pre-wrap';
            tempDiv.style.backgroundColor = 'white';
            
            // Add to DOM temporarily
            document.body.appendChild(tempDiv);
            
            // Create a promise chain that processes each page sequentially
            promiseChain = promiseChain
                .then(() => html2canvas(tempDiv, {
                    scale: 2,
                    backgroundColor: 'white',
                    logging: false
                }))
                .then(canvas => {
                    pageCanvases.push(canvas);
                    document.body.removeChild(tempDiv);
                });
        });
        
        // After all pages are processed, add them to the PDF
        promiseChain.then(() => {
            pageCanvases.forEach((canvas, index) => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const imgWidth = 190; // Slightly narrower than page for margins
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                if (index > 0) {
                    doc.addPage();
                }
                
                doc.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
            });
            
            doc.save(filename);
        });
    } else {
        // For single page letter document
        html2canvas(previewElement, {
            scale: 2,
            backgroundColor: 'white',
            logging: false
        }).then(canvas => {
            const imgData = canvas.toDataURL('image/jpeg', 1.0);
            const imgWidth = 190;
            const imgHeight = canvas.height * imgWidth / canvas.width;
            
            doc.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
            
            // Check if we need multiple pages
            if (imgHeight > 277) { // Height of US Letter minus margins
                const pageHeight = 277;
                let heightLeft = imgHeight - pageHeight;
                let position = -pageHeight; // First position is negative because we're moving up
                
                while (heightLeft > 0) {
                    position -= pageHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'JPEG', 10, position + 10, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
            }
            
            doc.save(filename);
        });
    }
}
