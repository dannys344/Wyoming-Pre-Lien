function generatePDF(type) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'letter'
    });

    // Determine which preview element to use based on type
    const previewElementId = type === 'lien' ? 'previewLienDocument' : 'previewLetterDocument';
    const propertyAddress = document.getElementById('propertyAddress').value || 'unknown-address';
    
    // Extract just the street address part (remove city, state, zip)
    const streetAddressOnly = propertyAddress.split(',')[0].trim();
    const sanitizedAddress = streetAddressOnly.replace(/[^\w\s]/gi, '').replace(/\s+/g, '-');
    
    const filename = type === 'lien' ? 
        `Notice of Right to Lien - ${sanitizedAddress}.pdf` : 
        `Notice Letter - ${sanitizedAddress}.pdf`;
    
    const previewElement = document.getElementById(previewElementId);
    
    if (type === 'lien') {
        // For multi-page lien document
        const pageContents = previewElement.innerHTML.split('<div class="page-break"></div>');
        let pageIndex = 0;
        
        function processNextPage() {
            if (pageIndex >= pageContents.length) {
                doc.save(filename);
                return;
            }
            
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = pageContents[pageIndex];
            tempDiv.style.width = '215.9mm'; // Letter width
            tempDiv.style.padding = '15mm';
            tempDiv.style.fontFamily = 'Times New Roman';
            tempDiv.style.fontSize = '12pt';
            tempDiv.style.lineHeight = '1.5';
            tempDiv.style.whiteSpace = 'pre-wrap';
            tempDiv.style.backgroundColor = 'white';
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv, {
                scale: 2,
                backgroundColor: 'white',
                logging: false
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const imgWidth = 190; // Slightly narrower than page for margins
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                if (pageIndex > 0) {
                    doc.addPage();
                }
                
                doc.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
                document.body.removeChild(tempDiv);
                
                pageIndex++;
                processNextPage();
            });
        }
        
        processNextPage();
    } else {
        // For single page letter document
        html2canvas(previewElement, {
            scale: 2,
            backgroundColor: 'white',
            logging: false
        }).then(canvas => {
            const imgData = canvas.toDataURL('image/jpeg', 1.0);
            const imgWidth = 190;
            const imgHeight = canvas.height * imgWidth / canvas.width;
            
            doc.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
            doc.save(filename);
        });
    }
}
